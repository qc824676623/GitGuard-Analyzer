# IPGeoAnalyzer for GitLab - nginx IPåœ°ç†å¨èƒåˆ†æå·¥å…·

[![Version](https://img.shields.io/badge/Version-1.0.0-blue)](https://github.com/yourusername/IPGeoAnalyzer)
[![Python](https://img.shields.io/badge/Python-3.6%2B-green)](https://python.org)
[![License](https://img.shields.io/badge/License-GPL--3.0-orange)](https://www.gnu.org/licenses/gpl-3.0.html)

ä¸“ä¸ºGitLabæ„å»ºçš„IPåœ°ç†å¨èƒåˆ†æå·¥å…·ï¼ŒåŸºäºnginxæ—¥å¿—åˆ†æï¼Œæä¾›å…¨çƒå¼‚å¸¸è®¿é—®æ¥æºå¯è§†åŒ–ã€‚

## ğŸ“¦ éƒ¨ç½²æŒ‡å—

### é¡¹ç›®ç»“æ„
```
ipanalyzer/
â”œâ”€â”€ nginx_ip_geo_stats.py# ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ map/# åœ°å›¾æ•°æ®
â”‚  â”œâ”€â”€ dbip_geo.txt# åœ°ç†æ–‡æœ¬æ•°æ®
â”‚  â”œâ”€â”€ dbip_index.bin# äºŒè¿›åˆ¶ç´¢å¼•
â”‚  â””â”€â”€ dbip_tobin.py# æ•°æ®è½¬æ¢å·¥å…·
â”œâ”€â”€ dbip-city-lite-2025-09.csv # IPæ•°æ®åº“ï¼ˆæ–‡ä»¶è¿‡å¤§ï¼Œéœ€è¦æ›´æ–°æ—¶è¯·è‡ªè¡Œä¸‹è½½ï¼‰
â””â”€â”€ gitlab_error.log# é”™è¯¯æ—¥å¿—ï¼ˆç”¨äºæµ‹è¯•ï¼‰
```

### é…ç½®è¯´æ˜
```python
LOG_DIR = "/var/log/gitlab/nginx/"# nginxæ—¥å¿—ç›®å½•
BIN_INDEX_PATH = "map/dbip_index.bin" # äºŒè¿›åˆ¶ç´¢å¼•è·¯å¾„
GEO_TEXT_PATH = "map/dbip_geo.txt"# åœ°ç†æ–‡æœ¬è·¯å¾„
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | çŠ¶æ€ | æè¿° |
|------|------|------|
| ğŸŒ IPåœ°ç†åˆ†å¸ƒ | âœ… | å…¨çƒè®¿é—®æ¥æºå¯è§†åŒ– |
| ğŸ“Š å®æ—¶æ—¥å¿—åˆ†æ | âœ… | æ”¯æŒ.gzå‹ç¼©æ—¥å¿— |
| ğŸ—ºï¸ äº¤äº’å¼åœ°å›¾ | âœ… | Foliumçƒ­åŠ›å›¾ |
| â° å¤šæ—¶é—´ç²’åº¦ | âœ… | å¤©/å‘¨/æœˆåˆ†æ |
| ğŸ‡¨ğŸ‡³ ä¸­æ–‡æ”¯æŒ | âœ… | å®Œæ•´ä¸­æ–‡å­—ä½“ |

## ğŸ” å·¥ä½œåŸç†

### æ•°æ®å¤„ç†æµç¨‹
- **æ—¥å¿—è§£æ**ï¼šè¯»å–gitlabå†…ç½®nginxæ—¥å¿—ï¼ŒåŒ…æ‹¬gitlab_error.log gitlab_error.log.*.gzæ—¥å¿—ï¼Œæ­£åˆ™æå–IPã€æ—¶é—´æˆ³ã€URL
- **IPå®šä½**ï¼šIPè½¬æ•´æ•°æ ¼å¼ï¼ŒäºŒåˆ†æŸ¥æ‰¾åŒ¹é…IPæ®µ
- **æ•°æ®ç»Ÿè®¡**ï¼šå¤šç»´åº¦ç»Ÿè®¡è®¿é—®é¢‘æ¬¡ï¼Œæ—¶é—´èšåˆåˆ†æ
- **å¯è§†åŒ–**ï¼šMatplotlibå›¾è¡¨ + Foliumäº¤äº’åœ°å›¾

### æ ¸å¿ƒæŠ€æœ¯
- IPè½¬æ¢ç®—æ³•ï¼šIPv4è½¬32ä½æ•´æ•°å¿«é€ŸæŸ¥æ‰¾
- äºŒåˆ†æŸ¥æ‰¾ä¼˜åŒ–ï¼šO(log n)é«˜æ•ˆIPåŒ¹é…
- å¤šçº¿ç¨‹å¤„ç†ï¼šå¹¶å‘å¤„ç†æ—¥å¿—æ–‡ä»¶
- å†…å­˜æ˜ å°„ï¼šäºŒè¿›åˆ¶ç´¢å¼•å‡å°‘å†…å­˜å ç”¨

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

1. **å®‰è£…ä¾èµ–**:
```bash
pip install -r requirements.txt
```

2. **å‡†å¤‡æ•°æ®**:[ä»…éœ€è¦æ›´æ–°åœ°å›¾ä¿¡æ¯æ—¶æ‰§è¡Œ]
```bash
python3 map/dbip_tobin.py
```

3. **å¯åŠ¨åº”ç”¨**:
```bash
python3 nginx_ip_geo_stats.py
```

4. **è®¿é—®ç•Œé¢**: `http://localhost:5000`

## âœ¨ é¡¹ç›®ç‰¹ç‚¹

- ğŸš€ å•æ–‡ä»¶æ ¸å¿ƒåº”ç”¨
- ğŸ“Š ä¸°å¯Œæ•°æ®å¯è§†åŒ–
- ğŸ”§ è·¨å¹³å°æ”¯æŒ
- ğŸ“ˆ ç”Ÿäº§ç¯å¢ƒå°±ç»ª
- âš¡ é«˜æ€§èƒ½å¤„ç†

## ğŸ“ æ•°æ®æ–‡ä»¶

### dbip-city-lite-2025-09.csv
**æ¥æº**: DB-IPå…è´¹åœ°ç†æ•°æ®åº“
**æ ¼å¼**: èµ·å§‹IP|ç»“æŸIP|å›½å®¶ä»£ç |å›½å®¶|åœ°åŒº|åŸå¸‚|çº¬åº¦|ç»åº¦
**æ›´æ–°**: æ¯æœˆä»https://db-ip.comä¸‹è½½æ›´æ–°

### dbip_tobin.py
**åŠŸèƒ½**: CSVè½¬äºŒè¿›åˆ¶ç´¢å¼•
- IPæ®µç´¢å¼•ï¼š12å­—èŠ‚/è®°å½•ï¼ˆèµ·å§‹IP+ç»“æŸIP+åœ°ååç§»ï¼‰
- åœ°åå»é‡ï¼šå‡å°‘å­˜å‚¨ç©ºé—´
- æ€§èƒ½æå‡ï¼šæ¯”CSVæŸ¥è¯¢å¿«10-100å€

## ğŸ–¼ï¸ ç•Œé¢é¢„è§ˆ

<div align="center">

![ä»ªè¡¨ç›˜ç•Œé¢](https://github.com/user-attachments/assets/26a07ad7-c59e-491d-bb1e-34f266505489)
*å›¾1ï¼šç³»ç»Ÿä»ªè¡¨ç›˜ç•Œé¢*

![ä»ªè¡¨ç›˜](https://github.com/user-attachments/assets/92abbd2b-5d23-4e14-9777-9e69e2b49b1e)
*å›¾2ï¼š*URLè®¿é—®é¢‘æ¬¡ç»Ÿè®¡*

![æ—¶é—´åˆ†å¸ƒå›¾](https://github.com/user-attachments/assets/f7f4be30-5986-46be-9638-43d2d925ee6b)
*å›¾3ï¼š*æ—¶é—´åˆ†å¸ƒå›¾*

![è®¿é—®ç»Ÿè®¡](https://github.com/user-attachments/assets/78cc5fbe-1f1d-4b15-95ea-fc8605628c54)
![è¯¦ç»†åˆ†æ](https://github.com/user-attachments/assets/e28e2e38-007f-4409-a861-105de298271f)
![å®æ—¶ç›‘æ§](https://github.com/user-attachments/assets/8d4f46a7-e309-4371-bce1-8392073a7dcf)
*å›¾4ï¼šè¯¦ç»†åˆ†æé¡µé¢*



</div>

## Pythonç‰ˆæœ¬è¦æ±‚
æœ¬é¡¹ç›®æ¨èä½¿ç”¨ Python 3.6+ ç‰ˆæœ¬

## ä¾èµ–åˆ—è¡¨
```txt
flask==2.3.3
matplotlib==3.7.2
seaborn==0.12.2
pandas==2.0.3
folium==0.14.0
```

---

**ğŸ“ é—®é¢˜åé¦ˆ** | **âœ¨ åŠŸèƒ½è¯·æ±‚** | **ğŸ› BugæŠ¥å‘Š**

*Â© 2025 IPGeoAnalyzer é¡¹ç›®ç»„ã€‚MITè®¸å¯è¯ã€‚*
